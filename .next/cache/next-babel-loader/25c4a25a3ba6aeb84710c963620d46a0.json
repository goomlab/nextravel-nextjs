{"ast":null,"code":"var __jsx = React.createElement;\nimport React from \"react\";\nimport { connect } from 'react-redux';\nimport Link from \"next/link\";\nimport NextHead from 'next/head';\nimport { HotelSchema, makeHotelSchema } from \"~/components/JsonLdSchema\";\nimport BaseService from \"~/packages/BaseService\";\nimport MenuService from \"~/packages/Post/services/MenuService\";\nimport PostService from \"~/packages/Post/services/PostService\";\nimport HotelService from \"~/packages/TravelgoOne/services/HotelService\";\nimport LocService from \"~/packages/TravelgoOne/services/LocService\";\nimport HotelCategoryService from \"~/packages/TravelgoOne/services/HotelCategoryService\";\nimport HotelAction from \"~/packages/TravelgoOne/actions/HotelAction\";\nimport Layout from \"~/components/Layouts/MainLayout/MainLayout\";\nimport BookingSearchBox from \"~/components/Partials/BookingSearchBox\"; // import HotelArchive from \"~/components/Partials/HotelArchive\";\n\nimport HotelArchive2 from \"~/components/Partials/HotelArchive2\";\nimport HomeRecap from \"~/components/Partials/HomeRecap\";\nimport Newsletter from \"~/components/Partials/Newsletter\";\n\nconst Index = props => {\n  if (!props.page || props.page.length <= 0) {\n    return __jsx(Layout, {\n      settings: {\n        menu: props.menu\n      }\n    }, __jsx(\"div\", null, \"Data not found\"));\n  }\n\n  React.useEffect(() => {\n    props.query({\n      hasEmptyPeriods: true,\n      orderBy: 'order_seq',\n      orderHow: 'asc',\n      page: props.hotelSeatchParams.page,\n      paginate: 4 //process.env.pagination.paginate\n\n    });\n  }, []);\n  const [hotelLoading, setHotelLoading] = React.useState(props.hotelLoading);\n\n  function logit() {\n    let scrollY = window.pageYOffset;\n    let hotelBoxEnd = document.getElementById('hotel-archive-end').offsetTop;\n\n    if (props.hotelLoading == 0 && scrollY > hotelBoxEnd - window.innerHeight) {\n      setHotelLoading(1);\n      props.query({\n        hasEmptyPeriods: true,\n        orderBy: 'order_seq',\n        orderHow: 'asc',\n        page: props.hotelSeatchParams.page,\n        paginate: 4 //process.env.pagination.paginate\n\n      });\n    }\n  }\n\n  React.useEffect(() => {\n    function watchScroll() {\n      window.addEventListener(\"scroll\", logit);\n    }\n\n    watchScroll();\n    return () => {\n      window.removeEventListener(\"scroll\", logit);\n    };\n  });\n  return __jsx(Layout, {\n    settings: {\n      template: \"front-page\",\n      menu: props.menu\n    },\n    meta: {\n      title: props.page.meta_title.it,\n      description: props.page.meta_description.it,\n      url: `${process.env.meta.url}`,\n      // image: (props.page.media && props.page.media.gallery && props.page.media.gallery[0]) ? props.page.media.gallery[0].url : null\n      image: props.page.media && props.page.media.thumbnails && props.page.media.thumbnails[0] ? props.page.media.thumbnails[0].url : null\n    }\n  }, props.hotels && props.hotels && __jsx(NextHead, null, props.hotels && props.hotels && Object.entries(props.hotels).map(([key, hotel]) => __jsx(\"script\", {\n    key: `jobJSON-${hotel.id}`,\n    type: \"application/ld+json\",\n    dangerouslySetInnerHTML: {\n      __html: JSON.stringify(makeHotelSchema(hotel))\n    }\n  }))), __jsx(\"section\", {\n    className: \"section-main section-first home\"\n  }, __jsx(\"div\", {\n    className: \"container\"\n  }, __jsx(\"div\", {\n    className: \"row\"\n  }, __jsx(\"div\", {\n    className: \"col-lg-7\"\n  }, __jsx(\"div\", {\n    className: \"primary-title\"\n  }, __jsx(\"h1\", null, props.page.subtitle.it), __jsx(\"span\", {\n    style: {\n      color: \"#384044\",\n      textDecoration: \"underline\"\n    }\n  }, \"Chiama! \", process.env.contacts.phone.label))), __jsx(\"div\", {\n    className: \"col-lg-4 col-offset-1\"\n  }, __jsx(\"div\", {\n    className: \"primary-description\"\n  }, __jsx(\"div\", {\n    dangerouslySetInnerHTML: {\n      __html: props.page.content.it\n    }\n  })))))), __jsx(BookingSearchBox, {\n    query: props.query,\n    full: true\n  }), __jsx(\"section\", {\n    className: \"section-main\"\n  }, __jsx(\"div\", {\n    className: \"container\"\n  }, __jsx(\"div\", {\n    className: \"primary-title text-center\"\n  }, __jsx(\"h2\", null, \"Prenota la tua vacanza tra una vasta scelta di Hotel selezionati.\")), __jsx(\"div\", {\n    className: \"primary-description text-center\"\n  }, \"Per qualsiasi informazione non esitare a contattarci allo\", \" \", __jsx(\"strong\", null, process.env.contacts.phone.label)))), __jsx(HotelArchive2, {\n    hotels: props.hotels ? props.hotels : []\n  }), props.hotels && props.hotels.meta && parseInt(props.hotels.meta.to) < parseInt(props.hotels.meta.last_page) && __jsx(\"section\", {\n    className: \"section-main\"\n  }, __jsx(\"div\", {\n    className: \"container text-center\"\n  }, __jsx(Link, {\n    href: `${process.env.accommodations_path}`,\n    as: `${process.env.accommodations_path}?page=2`\n  }, __jsx(\"a\", {\n    className: \"btn btn-more\"\n  }, \"Carica le altre offerte\")))), __jsx(HomeRecap, props), __jsx(Newsletter, null));\n};\n\nIndex.getInitialProps = async ctx => {\n  let menu = null; // let months = [];\n  // let specials = [];\n  // let locs = [];\n  // let hotelCategories = [];\n\n  let page = null;\n  let busPage = null;\n  let hotels = [];\n\n  try {\n    // initialProps = mainInitialProps();\n    // let baseService = new BaseService();\n    // let init = await baseService.initApp();\n    // locs = init.locs || [];\n    // hotelCategories = init.hotelCategories || [];\n    // months = init.filterPages.months || [];\n    // specials = init.filterPages.specials || [];\n    let menuService = new MenuService();\n    menu = await menuService.get(1);\n    let postService = new PostService();\n    page = await postService.get(1);\n    busPage = await postService.get(3); // let hotelService = new HotelService();\n    // hotels = await hotelService.query({\n    //   hasEmptyPeriods: true,\n    //   orderBy: 'order_seq',\n    //   orderHow: 'asc',\n    //   paginate: process.env.pagination.paginate\n    // });\n  } catch (e) {\n    console.log('error', e);\n  }\n\n  return {\n    params: ctx.params,\n    query: ctx.query,\n    menu,\n    // specials,\n    // locs,\n    // hotelCategories,\n    page,\n    busPage // hotels\n\n  };\n}; // export default Index;\n\n\nconst mapStateToProps = state => {\n  return {\n    hotelLoading: state.hotel.loading,\n    hotelSeatchParams: state.hotel.params,\n    hotels: state.hotel.items,\n    hotelMeta: state.hotel.meta\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  let hotelAction = new HotelAction();\n  return {\n    loading: state => {\n      dispatch(hotelAction.loading(state));\n    },\n    query: data => {\n      dispatch(hotelAction.query(data));\n    }\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Index);","map":null,"metadata":{},"sourceType":"module"}