{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React from 'react';\nimport { connect } from 'react-redux';\nimport moment from 'moment';\nimport * as yup from 'yup';\nimport { useFormik } from 'formik';\nimport HotelServiceService from '~/packages/TravelgoOne/services/HotelServiceService';\nimport PracticeByGuestAction from '~/packages/TravelgoOne/actions/PracticeByGuestAction';\nimport MyDateRangePicker from '../MyDateRangePicker';\n\nvar BookingForm = function BookingForm(props) {\n  var _React$useState = React.useState([]),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      treatments = _React$useState2[0],\n      setTreatments = _React$useState2[1]; // let priceList = {}\n  // for (const [roomTypeName, roomTypeContent] of Object.entries(period.viewPeriodPrices)){\n  //   priceList[roomTypeName] = {};\n  //   if( roomTypeContent.prices ){\n  //     for (const [key, treatmentObj] of Object.entries(roomTypeContent.prices)) {\n  //       priceList[roomTypeName][key] = {\n  //         n1: (treatmentObj.n1) ? treatmentObj.n1 : null,\n  //         n2: (treatmentObj.n2) ? treatmentObj.n2 : null,\n  //         n3: (treatmentObj.n3) ? treatmentObj.n3 : null,\n  //         n4: (treatmentObj.n4) ? treatmentObj.n4 : null,\n  //         n5: (treatmentObj.n5) ? treatmentObj.n5 : null,\n  //         n6: (treatmentObj.n6) ? treatmentObj.n6 : null,\n  //         n7: (treatmentObj.n7) ? treatmentObj.n7 : null,\n  //       };\n  //     }\n  //   }\n  // }\n\n  /**\n   * ComponentDidUpdate\n   */\n\n\n  React.useEffect(function () {\n    //console.log('componentDidUpdate', props.practice, props.query)\n    var newState = Object.assign({}, props.practice);\n    props.setPractice(_objectSpread(_objectSpread({}, newState), {}, {\n      hotel_id: props.hotel.id,\n      rate_plan_id: props.rateplan.id,\n      checkin: props.query.checkin || null,\n      checkout: props.query.checkout || null,\n      treatment: props.query.treatment || null,\n      room_type_id: props.query.room_type_id || null\n    })); // calcolo i trattamenti della camera scelta\n\n    if (props.query.room_type_id != null && props.query.room_type_id > 0) {\n      var _treatments = [];\n\n      for (var _i = 0, _Object$entries = Object.entries(props.period.viewPeriodPrices); _i < _Object$entries.length; _i++) {\n        var _Object$entries$_i = _slicedToArray(_Object$entries[_i], 2),\n            roomTypeName = _Object$entries$_i[0],\n            roomTypeContent = _Object$entries$_i[1];\n\n        if (roomTypeContent.room_type.id == props.query.room_type_id) {\n          for (var _i2 = 0, _Object$entries2 = Object.entries(roomTypeContent.prices); _i2 < _Object$entries2.length; _i2++) {\n            var _Object$entries2$_i = _slicedToArray(_Object$entries2[_i2], 2),\n                treatmentKey = _Object$entries2$_i[0],\n                treatmentPrices = _Object$entries2$_i[1];\n\n            _treatments.push(treatmentKey);\n          }\n        }\n      }\n\n      setTreatments(_treatments);\n    }\n  }, [props.query]);\n\n  var _React$useState3 = React.useState([]),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      transfers = _React$useState4[0],\n      setTransfers = _React$useState4[1];\n\n  React.useEffect(function () {\n    var service = new HotelServiceService();\n    service.all({\n      type: {\n        key: 'type',\n        compare: '=',\n        value: 'transfer'\n      }\n    }).then(function (response) {\n      setTransfers(response);\n    });\n  }, []);\n\n  var _onChange = function onChange(e) {\n    e.persist();\n    var newState = Object.assign({}, props.practice);\n\n    switch (e.target.name) {\n      case 'room_type_id':\n        var _flag = false;\n\n        for (var _i3 = 0, _Object$entries3 = Object.entries(props.period.viewPeriodPrices); _i3 < _Object$entries3.length; _i3++) {\n          var _Object$entries3$_i = _slicedToArray(_Object$entries3[_i3], 2),\n              roomTypeName = _Object$entries3$_i[0],\n              roomTypeContent = _Object$entries3$_i[1];\n\n          if (roomTypeContent.room_type.id == e.target.value) {\n            var _treatments2 = [];\n\n            for (var _i4 = 0, _Object$entries4 = Object.entries(roomTypeContent.prices); _i4 < _Object$entries4.length; _i4++) {\n              var _Object$entries4$_i = _slicedToArray(_Object$entries4[_i4], 2),\n                  treatmentKey = _Object$entries4$_i[0],\n                  treatmentPrices = _Object$entries4$_i[1];\n\n              _treatments2.push(treatmentKey);\n            }\n\n            setTreatments(_treatments2);\n            newState.customer[e.target.name] = e.target.value;\n            _flag = true;\n            break;\n          }\n        }\n\n        if (!_flag) setTreatments([]);\n        break;\n\n      case 'privacy':\n        newState[e.target.name] = e.target.checked ? 1 : 0;\n        break;\n\n      case 'first_name':\n      case 'last_name':\n      case 'email':\n      case 'mobile':\n        newState.customer[e.target.name] = e.target.value;\n        break;\n\n      default:\n        newState[e.target.name] = e.target.value;\n        break;\n    }\n\n    props.setPractice(newState);\n  };\n\n  var onChangeDatePicker = function onChangeDatePicker(startDate, endDate) {\n    var newState = Object.assign({}, props.practice);\n    newState.checkin = startDate.format('YYYY-MM-DD');\n    newState.checkout = endDate.format('YYYY-MM-DD');\n    props.setPractice(newState);\n  };\n  /**\n   * Room\n   */\n\n\n  var onAddRoom = function onAddRoom() {\n    var newState = Object.assign({}, props.practice);\n    newState.rooms.push({\n      adults: 2,\n      childrens: 0,\n      childrenAges: []\n    });\n    props.setPractice(newState);\n  };\n\n  var onDeleteRoom = function onDeleteRoom(index) {\n    var newState = Object.assign({}, props.practice);\n    newState.rooms.splice(index, 1);\n    props.setPractice(newState);\n  };\n\n  var onAddRoomChildren = function onAddRoomChildren(e, index) {\n    var newState = Object.assign({}, props.practice);\n    newState.rooms[index].childrenAges.push(e.target.value);\n    newState.rooms[index].childrenAges.sort();\n    props.setPractice(newState);\n  };\n\n  var onChangeRoom = function onChangeRoom(e, index) {\n    e.persist();\n    var newState = Object.assign({}, props.practice);\n\n    switch (e.currentTarget.dataset.name) {\n      case \"childrens\":\n        if (parseInt(e.currentTarget.value) == 0) {\n          // reset childrenAges\n          newState.rooms[index].childrenAges = [];\n        } else if (newState.rooms[index].childrens > parseInt(e.currentTarget.value)) {\n          // rimuovo gli utlimi elementi\n          newState.rooms[index].childrenAges.splice(e.currentTarget.value);\n        } else {\n          // aggiungo age con valore 0\n          for (var j = newState.rooms[index].childrens; j < parseInt(e.currentTarget.value); j++) {\n            newState.rooms[index].childrenAges.push(-1);\n          }\n        }\n\n        newState.rooms[index].childrens = e.currentTarget.value;\n        break;\n\n      case \"ageChildrens\":\n        var indexChild = e.currentTarget.dataset.index;\n        newState.rooms[index].childrenAges[indexChild] = e.currentTarget.value;\n        newState.rooms[index].childrenAges.sort(function (a, b) {\n          return b - a;\n        }); // sort desc\n\n        break;\n\n      default:\n        newState.rooms[index][e.currentTarget.dataset.name] = e.currentTarget.value;\n        break;\n    }\n\n    props.setPractice(newState);\n  };\n  /**\n   * Submit\n   */\n\n\n  var handleSubmit = function handleSubmit() {\n    props.createPractice(props.practice);\n  };\n  /**\n   * Validate\n   */\n\n\n  var formik = useFormik({\n    initialValues: {\n      // checkin: props.checkin || \"\",\n      // checkout: props.practice.checkout || \"\",\n      treatment: props.practice.treatment || \"\",\n      room_type_id: props.practice.room_type_id || \"\",\n      first_name: props.practice.customer.first_name || \"\",\n      last_name: props.practice.customer.last_name || \"\",\n      email: props.practice.customer.email || \"\",\n      mobile: props.practice.customer.mobile || \"\",\n      privacy: props.practice.privacy || 0\n    },\n    validationSchema: yup.object().shape({\n      // checkin: yup.string().required('Campo non valido'),\n      // checkout: yup.string().required('Campo non valido'),\n      treatment: yup.string().required('Campo non valido'),\n      room_type_id: yup.string().required('Campo non valido'),\n      first_name: yup.string().required('Campo non valido'),\n      last_name: yup.string().required('Campo non valido'),\n      email: yup.string().required('Campo non valido'),\n      mobile: yup.string().required('Campo non valido'),\n      privacy: yup.number().min(1, 'Campo non valido').max(1, 'Campo non valido')\n    }),\n    enableReinitialize: true,\n    onSubmit: handleSubmit\n  });\n  /**\n   * Render\n   */\n\n  var renderRooms = function renderRooms() {\n    var _html = [];\n\n    var _loop = function _loop(i) {\n      // adults\n      _htmlAdultOptions = [];\n\n      _htmlAdultOptions.push(__jsx(\"option\", {\n        key: 0,\n        value: \"0\"\n      }, \"Adulti\"));\n\n      for (j = 1; j <= 4; j++) {\n        _htmlAdultOptions.push(__jsx(\"option\", {\n          key: j,\n          value: j\n        }, j));\n      } // childrens\n\n\n      _htmlChildrenOptions = [];\n\n      _htmlChildrenOptions.push(__jsx(\"option\", {\n        key: 0,\n        value: \"0\"\n      }, \"Bambini\"));\n\n      for (j = 1; j <= 4; j++) {\n        _htmlChildrenOptions.push(__jsx(\"option\", {\n          key: j,\n          value: j\n        }, j));\n      } // children ages\n\n\n      _ageOptions = [];\n\n      _ageOptions.push(__jsx(\"option\", {\n        key: -1,\n        value: \"\"\n      }, \"Et\\xE0\"));\n\n      for (j = 0; j <= 12; j++) {\n        _ageOptions.push(__jsx(\"option\", {\n          key: j,\n          value: j\n        }, j));\n      }\n\n      var _htmlChildrenAges = [];\n\n      for (var _j in props.practice.rooms[i].childrenAges) {\n        _htmlChildrenAges.push(__jsx(\"div\", {\n          key: _j,\n          className: \"col-lg-3\"\n        }, __jsx(\"div\", {\n          className: \"form-group\"\n        }, __jsx(\"select\", {\n          className: \"custom-select\",\n          name: \"childrens_age[]\",\n          \"data-name\": \"ageChildrens\",\n          \"data-index\": _j,\n          value: props.practice.rooms[i].childrenAges[_j] || 0,\n          onChange: function onChange(e) {\n            return onChangeRoom(e, i);\n          }\n        }, _ageOptions))));\n      }\n\n      _html.push(__jsx(\"div\", {\n        key: i,\n        className: \"row\"\n      }, __jsx(\"div\", {\n        className: \"col-lg-3\"\n      }, __jsx(\"div\", {\n        className: \"form-group\"\n      }, i == 0 && __jsx(\"button\", {\n        type: \"button\",\n        className: \"btn btn-green\",\n        onClick: function onClick() {\n          return onAddRoom();\n        }\n      }, \"+ Camera\"), i > 0 && __jsx(React.Fragment, null, __jsx(\"label\", null, \"camera \", __jsx(\"span\", {\n        className: \"room-number\"\n      }, parseInt(i) + 1)), \"\\xA0\\xA0\", __jsx(\"button\", {\n        type: \"button\",\n        className: \"btn btn-danger btn-sm roomBox_buttonDelete\",\n        onClick: function onClick() {\n          return onDeleteRoom(i);\n        }\n      }, __jsx(\"i\", {\n        className: \"fas fa-times\"\n      }))))), __jsx(\"div\", {\n        className: \"col-lg-2\"\n      }, __jsx(\"div\", {\n        className: \"form-group\"\n      }, __jsx(\"select\", {\n        className: \"custom-select\",\n        id: \"adults_\".concat(i),\n        name: \"adults[]\",\n        \"data-name\": \"adults\",\n        value: props.practice.rooms[i].adults || 0,\n        onChange: function onChange(e) {\n          return onChangeRoom(e, i);\n        }\n      }, \"$\", _htmlAdultOptions))), __jsx(\"div\", {\n        className: \"col-lg-2\"\n      }, __jsx(\"div\", {\n        className: \"form-group\"\n      }, __jsx(\"select\", {\n        className: \"custom-select\",\n        id: \"childrens_\".concat(i),\n        name: \"childrens[]\",\n        \"data-name\": \"childrens\",\n        value: props.practice.rooms[i].childrens || 0,\n        onChange: function onChange(e) {\n          return onChangeRoom(e, i);\n        }\n      }, \"$\", _htmlChildrenOptions))), __jsx(\"div\", {\n        className: \"col-lg-4\"\n      }, __jsx(\"div\", {\n        className: \"row table_childrenAges\"\n      }, _htmlChildrenAges))));\n    };\n\n    for (var i in props.practice.rooms) {\n      var _htmlAdultOptions;\n\n      var j;\n\n      var _htmlChildrenOptions;\n\n      var j;\n\n      var _ageOptions;\n\n      var j;\n\n      _loop(i);\n    }\n\n    return _html;\n  };\n\n  return __jsx(React.Fragment, null, __jsx(\"form\", {\n    onSubmit: formik.handleSubmit,\n    className: \"needs-validation\" + (formik.errors ? \"was-validated\" : \"\"),\n    noValidate: true\n  }, __jsx(\"div\", {\n    className: \"box2 form-template-1\"\n  }, __jsx(\"div\", {\n    className: \"row\"\n  }, __jsx(\"div\", {\n    className: \"col-lg-3\"\n  }, __jsx(\"div\", {\n    className: \"form-group\"\n  }, __jsx(\"label\", null, \"Arrivo - Partenza\"), __jsx(MyDateRangePicker, {\n    startDate: props.practice.checkin,\n    endDate: props.practice.checkout,\n    onChange: function onChange(startDate, endDate) {\n      return onChangeDatePicker(startDate, endDate);\n    }\n  }))), __jsx(\"div\", {\n    className: \"col-lg-3\"\n  }, __jsx(\"div\", {\n    className: \"form-group\"\n  }, __jsx(\"label\", null, \"Camera\"), __jsx(\"select\", {\n    className: \"custom-select\" + (formik.errors.treatment ? \" is-invalid\" : \"\"),\n    name: \"room_type_id\",\n    id: \"room_type_id\" // value={props.practice.treatment || ''}\n    // onChange={(e) => onChange(e)}\n    ,\n    value: formik.values.room_type_id || '',\n    onChange: function onChange(e) {\n      _onChange(e);\n\n      formik.handleChange(e);\n    }\n  }, __jsx(\"option\", {\n    value: \"\"\n  }, \"Camera\"), props.period.viewPeriodPrices && Object.entries(props.period.viewPeriodPrices).map(function (_ref, index) {\n    var _ref2 = _slicedToArray(_ref, 2),\n        roomTypeKey = _ref2[0],\n        roomTypeContent = _ref2[1];\n\n    return __jsx(\"option\", {\n      key: index,\n      value: roomTypeContent.room_type.id\n    }, roomTypeContent.room_type.name);\n  })), formik.errors.treatment && __jsx(\"div\", {\n    className: \"invalid-feedback\"\n  }, formik.errors.room_type_id))), __jsx(\"div\", {\n    className: \"col-lg-3\"\n  }, __jsx(\"div\", {\n    className: \"form-group\"\n  }, __jsx(\"label\", null, \"Trattamento\"), __jsx(\"select\", {\n    className: \"custom-select\" + (formik.errors.treatment ? \" is-invalid\" : \"\"),\n    name: \"treatment\",\n    id: \"treatment\" // value={props.practice.treatment || ''}\n    // onChange={(e) => onChange(e)}\n    ,\n    value: formik.values.treatment || '',\n    onChange: function onChange(e) {\n      _onChange(e);\n\n      formik.handleChange(e);\n    }\n  }, __jsx(\"option\", {\n    value: \"\"\n  }, \"Trattamento\"), treatments && treatments.map(function (key) {\n    return __jsx(\"option\", {\n      key: key,\n      value: key\n    }, key);\n  })), formik.errors.treatment && __jsx(\"div\", {\n    className: \"invalid-feedback\"\n  }, formik.errors.treatment))), __jsx(\"div\", {\n    className: \"col-lg-3\"\n  }, __jsx(\"div\", {\n    className: \"form-group\"\n  }, __jsx(\"label\", null, \"Transfer\"), __jsx(\"select\", {\n    className: \"custom-select\",\n    name: \"transfer_id\",\n    id: \"tranfer_id\",\n    value: props.practice.transfer_id || '',\n    onChange: function onChange(e) {\n      return _onChange(e);\n    }\n  }, __jsx(\"option\", {\n    value: \"\"\n  }, \"Transfer\"), transfers.map(function (obj, index) {\n    return __jsx(\"option\", {\n      key: index,\n      value: obj.id\n    }, obj.name);\n  }))))), __jsx(\"div\", {\n    className: \"room-box\",\n    id: \"roomBox\"\n  }, renderRooms())), __jsx(\"div\", {\n    className: \"box3 form-template-2\"\n  }, __jsx(\"div\", {\n    className: \"row\"\n  }, __jsx(\"div\", {\n    className: \"col-lg-3\"\n  }, __jsx(\"div\", {\n    className: \"form-group\"\n  }, __jsx(\"div\", {\n    className: \"title\"\n  }, \"Richiedi il tuo preventivo gratuitamente\"))), __jsx(\"div\", {\n    className: \"col-lg-4\"\n  }, __jsx(\"div\", {\n    className: \"form-group\"\n  }, __jsx(\"input\", {\n    type: \"text\",\n    className: \"form-control\" + (formik.errors.first_name ? \" is-invalid\" : \"\"),\n    id: \"first_name\",\n    name: \"first_name\",\n    placeholder: \"Nome\" // value={props.practice.customer.first_name || \"\"}\n    // onChange={(e)=>onChange(e)}\n    ,\n    value: formik.values.first_name || '',\n    onChange: function onChange(e) {\n      _onChange(e);\n\n      formik.handleChange(e);\n    } // reuired=\"true\"\n\n  }), formik.errors.first_name && __jsx(\"div\", {\n    className: \"invalid-feedback\"\n  }, formik.errors.first_name)), __jsx(\"div\", {\n    className: \"form-group\"\n  }, __jsx(\"input\", {\n    type: \"text\",\n    className: \"form-control\" + (formik.errors.last_name ? \" is-invalid\" : \"\"),\n    id: \"last_name\",\n    name: \"last_name\",\n    placeholder: \"Cognome\" // value={props.practice.customer.last_name || \"\"}\n    // onChange={(e)=>onChange(e)}\n    ,\n    value: formik.values.last_name || '',\n    onChange: function onChange(e) {\n      _onChange(e);\n\n      formik.handleChange(e);\n    }\n  }), formik.errors.last_name && __jsx(\"div\", {\n    className: \"invalid-feedback\"\n  }, formik.errors.last_name)), __jsx(\"div\", {\n    className: \"form-group\"\n  }, __jsx(\"input\", {\n    type: \"email\",\n    className: \"form-control\" + (formik.errors.email ? \" is-invalid\" : \"\"),\n    id: \"email\",\n    name: \"email\",\n    placeholder: \"Email\" // defaultValue={props.practice.customer.email || \"\"}\n    // onChange={(e)=>onChange(e)}\n    ,\n    value: formik.values.email || '',\n    onChange: function onChange(e) {\n      _onChange(e);\n\n      formik.handleChange(e);\n    }\n  }), formik.errors.email && __jsx(\"div\", {\n    className: \"invalid-feedback\"\n  }, formik.errors.email)), __jsx(\"div\", {\n    className: \"form-group\"\n  }, __jsx(\"input\", {\n    type: \"text\",\n    className: \"form-control\" + (formik.errors.mobile ? \" is-invalid\" : \"\"),\n    id: \"mobile\",\n    name: \"mobile\",\n    placeholder: \"Cellulare\" // defaultValue={props.practice.customer.mobile || \"\"}\n    // onChange={(e)=>onChange(e)}\n    ,\n    value: formik.values.mobile || '',\n    onChange: function onChange(e) {\n      _onChange(e);\n\n      formik.handleChange(e);\n    }\n  }), formik.errors.mobile && __jsx(\"div\", {\n    className: \"invalid-feedback\"\n  }, formik.errors.mobile))), __jsx(\"div\", {\n    className: \"col-lg-5\"\n  }, __jsx(\"div\", {\n    className: \"form-group\"\n  }, __jsx(\"textarea\", {\n    className: \"form-control\",\n    id: \"message\",\n    name: \"message\",\n    placeholder: \"Messaggio\",\n    value: props.practice.message || \"\",\n    onChange: function onChange(e) {\n      return _onChange(e);\n    }\n  })), __jsx(\"div\", {\n    className: \"form-group\"\n  }, __jsx(\"div\", {\n    className: \"custom-control custom-checkbox\"\n  }, __jsx(\"input\", {\n    type: \"checkbox\",\n    className: \"custom-control-input\" + (formik.errors.privacy ? \" is-invalid\" : \"\"),\n    name: \"privacy\",\n    id: \"privacy\" // value={props.practice.privacy || 0}\n    // onChange={(e)=>onChange(e)}\n    ,\n    value: \"1\",\n    checked: formik.values.privacy == 1 ? 1 : 0,\n    onChange: function onChange(e) {\n      _onChange(e);\n\n      formik.handleChange(e);\n    }\n  }), __jsx(\"label\", {\n    className: \"custom-control-label\",\n    htmlFor: \"privacy\"\n  }, \"Acconsento al trattamento dei miei dati ai sensi dell\\u2019informativa sulla \", __jsx(\"a\", {\n    href: \"/privacy-policy\",\n    target: \"_blank\",\n    rel: \"nofollow\"\n  }, \"Privacy\"), \".\"), formik.errors.privacy && __jsx(\"div\", {\n    className: \"invalid-feedback\"\n  }, formik.errors.privacy))), __jsx(\"div\", {\n    className: \"form-group text-right\"\n  }, __jsx(\"button\", {\n    type: \"submit\",\n    className: \"btn-submit\"\n  }, \"richiedi disponibilit\\xE0\")))))));\n};\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    practice: state.practiceByGuest.item\n  };\n};\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  var practiceByGuestAction = new PracticeByGuestAction();\n  return {\n    setPractice: function setPractice(data) {\n      dispatch(practiceByGuestAction.setItem(data));\n    },\n    resetPractice: function resetPractice() {\n      dispatch(practiceByGuestAction.resetItem());\n    },\n    createPractice: function createPractice(data) {\n      dispatch(practiceByGuestAction.create(data));\n    }\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(BookingForm);","map":null,"metadata":{},"sourceType":"module"}